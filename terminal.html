<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>粉蓝 CRT 终端</title>
    <style>
        body {
            background: #0a0a14;
            color: #A7C7E7;
            font-family: monospace;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .crt {
            width: 90vw;
            height: 80vh;
            background: #0a0a14;
            color: #89CFF0;
            font-size: 18px;
            line-height: 1.5;
            padding: 20px;
            box-shadow: inset 0 0 30px #1e3a8a;
            border-radius: 10px;
            overflow-y: auto;
            position: relative;
            text-shadow: 0 0 4px #B19CD9, 0 0 8px #FFB6C1;
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background: #89CFF0;
            margin-left: 2px;
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% {
                background: transparent;
            }
        }
    </style>
</head>

<body>
    <div class="crt" id="terminal"></div>

    <script>
        const terminal = document.getElementById("terminal");
        let buffer = "";
        let commandCount = 0; // 已输入命令计数

        // === 打字机效果 ===
        function typeLine(text, callback, speed = 40) {
            let i = 0;
            const line = document.createElement("div");
            terminal.appendChild(line);

            function typing() {
                line.innerHTML += text[i] === "\n" ? "<br>" : text[i]; // 支持 \n 换行
                i++;
                terminal.scrollTop = terminal.scrollHeight;
                if (i < text.length) {
                    setTimeout(typing, speed);
                } else if (callback) {
                    callback();
                }
            }
            typing();
        }

        // === 新提示符 ===
        function newPrompt() {
            const oldCursor = terminal.querySelector(".cursor");
            if (oldCursor) oldCursor.remove();

            const prompt = document.createElement("div");
            prompt.innerHTML = `C:\\> <span id="input"></span><span class="cursor"></span>`;
            terminal.appendChild(prompt);

            terminal.scrollTop = terminal.scrollHeight;
        }

        // === 清屏逻辑 ===
        function autoClearIfNeeded() {
            if (commandCount >= 10) {
                terminal.innerHTML = "";
                newPrompt();
                buffer = "";
                commandCount = 0;

                // 打字机效果提示
                typeLine("[Screen cleared automatically after 10 commands]", () => {
                    newPrompt();
                }, 30);
            }
        }

        // === 命令处理 ===
        function processCommand(cmd) {
            cmd = cmd.trim();
            const inputs = terminal.querySelectorAll("#input");
            const inputEl = inputs[inputs.length - 1];
            if (inputEl) {
                const parent = inputEl.parentNode;
                const cursor = parent.querySelector(".cursor");
                if (cursor) cursor.remove();
                parent.innerHTML = `C:\\> ${cmd}`;
            }

            let output = []; // 用数组存储输出

            switch (cmd.toLowerCase()) {
                case "help":
                    output = ["Commands: help, whoami, pacman, clear"];
                    break;
                case "whoami":
                    output = [
                        "I am a Master’s student at Duke University specializing in game development. My passion lies in games and in exploring innovative interactions as powerful metaphors for storytelling.",
                        "As a Game AI researcher, I study how games can serve as playgrounds for reinforcement learning agents to grow — and, in turn, how those agents can inform and enrich game design and development."
                    ]
                    break;
                case "pacman":
                    output = ["Loading pacman.html..."];
                    window.parent.postMessage("load-pacman", "*");
                    break;
                case "clear":
                    terminal.innerHTML = "";
                    newPrompt();
                    buffer = "";
                    commandCount = 0;
                    return;
                case "":
                    output = [""];
                    break;
                default:
                    output = [`'${cmd}' is not recognized.`];
            }

            // 渲染数组里的每一行
            output.forEach(text => {
                const line = document.createElement("div");
                line.textContent = text;
                terminal.appendChild(line);
            });

            commandCount++;
            autoClearIfNeeded();

            newPrompt();
            buffer = "";
        }


        // === 键盘输入 ===
        document.addEventListener("keydown", e => {
            const inputs = terminal.querySelectorAll("#input");
            const inputEl = inputs[inputs.length - 1];
            if (!inputEl) return;

            if (e.key === "Backspace") {
                buffer = buffer.slice(0, -1);
            } else if (e.key === "Enter") {
                processCommand(buffer);
            } else if (e.key.length === 1) {
                buffer += e.key;
            }
            inputEl.textContent = buffer;
        });

        // === 开机闪屏 ===
        function bootSequence() {
            let flashes = 0;
            const interval = setInterval(() => {
                terminal.style.opacity = terminal.style.opacity === "1" ? "0" : "1";
                flashes++;
                if (flashes > 0) {
                    clearInterval(interval);
                    terminal.style.opacity = "1";
                    startTerminal();
                }
            }, 300);
        }

        // === DOS 欢迎信息 ===
        function startTerminal() {
            typeLine("XINYU_PORTFOLIO v4.0", () => {
                typeLine("\n> Hi. I'm Xinyu, a game developer and Game AI researcher.", () => {
                    typeLine("> Welcome to my cyberspace.", () => {
                        typeLine("\nC:\\> Type 'help' for commands.", () => {
                            newPrompt();
                        });
                    });
                });
            });
        }

        bootSequence();
    </script>
</body>

</html>